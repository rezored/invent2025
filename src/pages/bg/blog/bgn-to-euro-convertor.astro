---
import Layout from "../../../layouts/Layout.astro";
import HeaderMain from "../../../components/HeaderMain.astro";
import { Code } from "astro:components";
const currentYear = new Date().getFullYear();
const lang = "bg";

const snippet = `// Класическият проблем с плаващата запетая в JS
console.log(0.1 + 0.2); // 0.30000000000000004

// Финансова калкулация без обработка на EPSILON
let price = 100 / 1.95583; // 51.129188...
let badRound = Math.round(price * 100) / 100; // 51.13`;
---

<Layout title="BGN към EUR: Проблемът с точността | Invent2025 Lab" lang={lang}>
    <Fragment slot="head">
        <meta
            property="og:title"
            content="BGN към EUR: Архитектура на миграцията"
        />
        <meta
            property="og:description"
            content="Technical deep dive into currency migration for WooCommerce stores using API-driven data integrity. Learn how we solved the €0.01 precision problem."
        />
        <meta
            property="og:image"
            content="https://invent2025.org/assets/cs-bgn-to-euro.png"
        />
        <meta
            property="og:url"
            content="https://invent2025.org/blog/bgn-to-euro-convertor"
        />
        <meta property="og:type" content="article" />
        <meta
            property="article:published_time"
            content="2026-01-07T09:00:00+02:00"
        />
        <meta property="article:author" content="Kalin Dimitrov" />

        <meta name="twitter:card" content="summary_large_image" />
        <meta
            name="twitter:image"
            content="https://invent2025.org/assets/cs-bgn-to-euro.png"
        />
    </Fragment>
    <!-- Syntax Highlighting -->

    <HeaderMain slot="header" />

    <main>
        <div class="mb-8">
            <a href="/blog" class="inline-flex items-center gap-3 group">
                <div
                    class="w-8 h-8 bg-slate-800 rounded flex items-center justify-center text-slate-400 border border-slate-700 group-hover:border-white group-hover:text-white transition-colors"
                >
                    <span class="material-symbols-outlined text-[20px]"
                        >arrow_back</span
                    >
                </div>
                <span
                    class="font-mono text-sm font-bold text-slate-500 group-hover:text-white transition-colors"
                    >КЪМ ЛАБОРАТОРИЯТА</span
                >
            </a>
        </div>
        <article class="prose prose-invert prose-lg max-w-none">
            <div class="not-prose mb-8 border-b border-border-dark pb-8">
                <div class="flex items-center gap-3 mb-4">
                    <span
                        class="inline-flex items-center px-2 py-1 rounded text-[10px] font-mono font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20"
                    >
                        ENGINEERING CASE STUDY
                    </span>
                    <span class="text-xs font-mono text-slate-500"
                        >07 Яну, 2026</span
                    >
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
                    Проблемът с точността от €0.01: Миграция на 10 хиляди
                    продукта
                </h1>
            </div>

            <img
                src="/assets/cs-bgn-to-euro.png"
                alt="BGN to EUR Migration"
                class="w-full rounded-lg"
            />

            <p class="lead text-xl text-slate-300">
                Мигрирането на WooCommerce база данни от BGN към EUR не е просто
                делене на 1.95583. Това е проблем на <strong
                    >плаващата запетая (floating point precision)</strong
                >, психологическите ценови стратегии и целостта на базата данни.
            </p>

            <div
                class="not-prose p-4 rounded bg-red-500/10 border-l-4 border-red-500 text-sm text-slate-300 mb-8"
            >
                <strong class="block text-red-400 mb-1">ПРАВЕН ОТКАЗ</strong>
                Официалният фиксиран курс (1.95583) трябва да се прилага "такъв, какъвто
                е" за правно съответствие. Всякакви допълнителни функции за закръгляне
                или корекция на цените (като "Smart Rounding") са само за удобство
                и представляват бизнес решение по усмотрение на търговеца. Това не
                е правен съвет.
            </div>

            <h3>1. Заблудата за "Простата Математика"</h3>
            <p>
                Повечето разработчици приемат, че проста SQL заявка или PHP
                цикъл са достатъчни:
                <code>$price / 1.95583</code>. Но когато се приложи към каталог
                от 10,000+ продукта, този наивен подход създава "грозни" цени и
                потенциални загуби на приходи.
            </p>

            <div class="not-prose my-8 overflow-x-auto">
                <table class="w-full text-left border-collapse text-sm">
                    <thead>
                        <tr class="border-b border-slate-700 text-slate-400">
                            <th class="py-2">Оригинал BGN</th>
                            <th class="py-2">Сурово Делене</th>
                            <th class="py-2">Стандартно Round(2)</th>
                            <th class="py-2 text-blue-400 font-bold"
                                >Smart Rounding (Плъгинът)</th
                            >
                        </tr>
                    </thead>
                    <tbody class="font-mono text-slate-300">
                        <tr class="border-b border-slate-800">
                            <td class="py-3">19.99 лв.</td>
                            <td class="py-3 text-slate-500">10.220724...</td>
                            <td class="py-3">€10.22</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€10.25 (Cash Friendly)</td
                            >
                        </tr>
                        <tr class="border-b border-slate-800">
                            <td class="py-3">49.90 лв.</td>
                            <td class="py-3 text-slate-500">25.513464...</td>
                            <td class="py-3">€25.51</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€25.50 (Clean)</td
                            >
                        </tr>
                        <tr class="border-b border-slate-800">
                            <td class="py-3">1250.00 лв.</td>
                            <td class="py-3 text-slate-500">639.11485...</td>
                            <td class="py-3">€639.11</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€639.99 (Psychological)</td
                            >
                        </tr>
                    </tbody>
                </table>
            </div>

            <p>
                <strong>Въздействието:</strong> За магазин с 5,000 артикула, използването
                на "Стандартно Закръгляне" води до цени като €13.04, €7.18 и €92.41.
                Това вреди на конверсиите. Нашата стратегия "Smart Rounding" (напр.
                закръгляне до .99) помага да се запази психологическата привлекателност
                на цените.
            </p>

            <h3>2. IEEE 754 и Опасността от Плаваща Запетая</h3>
            <p>
                JavaScript и PHP обработват числа с плаваща запетая (doubles) по
                начини, които могат да въведат микро-грешки при натрупване.
            </p>

            <div
                class="my-6 not-prose rounded-lg overflow-hidden border border-border-dark shadow-lg"
            >
                <Code
                    code={snippet}
                    lang="js"
                    theme="dracula"
                    style="padding: 1.5rem; overflow-x: auto;"
                />
            </div>

            <p>
                Когато обработвате милиони транзакции (или конвертирате голяма
                база данни), тези микро-грешки могат да се натрупат. Нашето API
                използва <strong>arbitrary-precision arithmetic</strong> библиотеки,
                за да гарантира, че курсът за приемане на еврото се прилага с правна
                точност, преди да се приложи каквато и да е стратегия за закръгляне.
            </p>

            <h3>3. Архитектура: Защо API?</h3>
            <p>
                Избрахме да изнесем логиката за конвертиране към Cloudflare
                Workers API поради три причини:
            </p>
            <ul>
                <li>
                    <strong>Атомарни партиди (Atomic Batches):</strong> Изпращаме
                    продукти на пакети от 50. API валидира целия пакет. Ако едно изчисление
                    е неуспешно (напр. невалиден тип данни), целият пакет се отхвърля.
                    Това предотвратява "частична корупция" на вашата база данни.
                </li>
                <li>
                    <strong>Неизменност (Immutability):</strong> Курсът на конвертиране
                    (1.95583) е твърдо кодиран и защитен в променливите на средата
                    на API. Той не може да бъде променен от злонамерен администратор
                    или бъгава WP тема.
                </li>
                <li>
                    <strong>Производителност:</strong> Изнасянето на математиката
                    спестява процесорни цикли на WP сървъра, позволявайки му да се
                    фокусира върху I/O (обновяване на записите в базата данни).
                </li>
            </ul>

            <div
                class="not-prose mt-12 p-8 bg-blue-900/10 border border-blue-500/20 rounded-2xl text-center"
            >
                <h4 class="text-white mb-4">
                    Анализирайте стратегията за миграция на вашия магазин
                </h4>
                <a
                    href="/products/bgn-to-euro-transition"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 rounded-full font-bold hover:bg-blue-500 transition-all"
                >
                    Виж Решението <span class="material-symbols-outlined"
                        >arrow_forward</span
                    >
                </a>
                <p class="mt-4 text-sm text-slate-500">
                    Създадено от <a
                        href="/"
                        class="text-blue-400 hover:text-white"
                        >Invent2025 Studio</a
                    >
                </p>
            </div>
        </article>
    </main>

    <footer
        slot="footer"
        class="mt-20 border-t border-border-dark pt-8 text-center"
    >
        <p class="text-slate-500 text-xs font-mono">
            © {currentYear} Invent2025 Ltd.
        </p>
    </footer>
</Layout>
