---
import Layout from "../../../layouts/Layout.astro";
import HeaderMain from "../../../components/HeaderMain.astro";
import { Code } from "astro:components";
const currentYear = new Date().getFullYear();

const snippet = `// The classic JS floating point issue
console.log(0.1 + 0.2); // 0.30000000000000004

// Financial calculation without handling EPSILON
let price = 100 / 1.95583; // 51.129188...
let badRound = Math.round(price * 100) / 100; // 51.13`;
---

<Layout title="BGN to EUR: The €0.01 Precision Problem | Invent2025 Lab">
    <Fragment slot="head">
        <meta
            property="og:title"
            content="BGN to EUR: Database Migration Architecture"
        />
        <meta
            property="og:description"
            content="Technical deep dive into currency migration for WooCommerce stores using API-driven data integrity. Learn how we solved the €0.01 precision problem."
        />
        <meta
            property="og:image"
            content="https://invent2025.org/assets/cs-bgn-to-euro.png"
        />
        <meta
            property="og:url"
            content="https://invent2025.org/blog/bgn-to-euro-convertor"
        />
        <meta property="og:type" content="article" />
        <meta
            property="article:published_time"
            content="2026-01-07T09:00:00+02:00"
        />
        <meta property="article:author" content="Kalin Dimitrov" />

        <meta name="twitter:card" content="summary_large_image" />
        <meta
            name="twitter:image"
            content="https://invent2025.org/assets/cs-bgn-to-euro.png"
        />
    </Fragment>
    <!-- Syntax Highlighting -->

    <HeaderMain slot="header" />

    <main>
        <div class="mb-8">
            <a href="/blog" class="inline-flex items-center gap-3 group">
                <div
                    class="w-8 h-8 bg-slate-800 rounded flex items-center justify-center text-slate-400 border border-slate-700 group-hover:border-white group-hover:text-white transition-colors"
                >
                    <span class="material-symbols-outlined text-[20px]"
                        >arrow_back</span
                    >
                </div>
                <span
                    class="font-mono text-sm font-bold text-slate-500 group-hover:text-white transition-colors"
                    >BACK TO LAB</span
                >
            </a>
        </div>
        <article class="prose prose-invert prose-lg max-w-none">
            <div class="not-prose mb-8 border-b border-border-dark pb-8">
                <div class="flex items-center gap-3 mb-4">
                    <span
                        class="inline-flex items-center px-2 py-1 rounded text-[10px] font-mono font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20"
                    >
                        ENGINEERING CASE STUDY
                    </span>
                    <span class="text-xs font-mono text-slate-500"
                        >Jan 07, 2026</span
                    >
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
                    The €0.01 Precision Problem: Migrating 10k Products
                </h1>
            </div>

            <!-- add the image here cs-bgn-to-euro.png -->
            <img
                src="/assets/cs-bgn-to-euro.png"
                alt="BGN to EUR Migration"
                class="w-full rounded-lg"
            />

            <p class="lead text-xl text-slate-300">
                Migrating a WooCommerce database from BGN to EUR isn't just
                about dividing by 1.95583. It is a problem of <strong
                    >floating point precision</strong
                >, psychological pricing strategies, and database integrity.
            </p>

            <div
                class="not-prose p-4 rounded bg-red-500/10 border-l-4 border-red-500 text-sm text-slate-300 mb-8"
            >
                <strong class="block text-red-400 mb-1">LEGAL DISCLAIMER</strong
                >
                The official fixed exchange rate (1.95583) must be applied "as is"
                for legal compliance. Any additional rounding or price adjustments
                features (like "Smart Rounding") are for convenience only and represent
                a business decision at the sole discretion of the merchant. This is
                not legal advice.
            </div>

            <h3>1. The "Simple Math" Fallacy</h3>
            <p>
                Most developers assume a simple SQL query or PHP loop is enough:
                <code>$price / 1.95583</code>. But when applied to a catalog of
                10,000+ products, this naive approach creates "ugly" prices and
                potential revenue leaks.
            </p>

            <div class="not-prose my-8 overflow-x-auto">
                <table class="w-full text-left border-collapse text-sm">
                    <thead>
                        <tr class="border-b border-slate-700 text-slate-400">
                            <th class="py-2">Original BGN</th>
                            <th class="py-2">Raw Division</th>
                            <th class="py-2">Standard Round(2)</th>
                            <th class="py-2 text-blue-400 font-bold"
                                >Smart Rounding (The Plugin)</th
                            >
                        </tr>
                    </thead>
                    <tbody class="font-mono text-slate-300">
                        <tr class="border-b border-slate-800">
                            <td class="py-3">19.99 лв.</td>
                            <td class="py-3 text-slate-500">10.220724...</td>
                            <td class="py-3">€10.22</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€10.25 (Cash Friendly)</td
                            >
                        </tr>
                        <tr class="border-b border-slate-800">
                            <td class="py-3">49.90 лв.</td>
                            <td class="py-3 text-slate-500">25.513464...</td>
                            <td class="py-3">€25.51</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€25.50 (Clean)</td
                            >
                        </tr>
                        <tr class="border-b border-slate-800">
                            <td class="py-3">1250.00 лв.</td>
                            <td class="py-3 text-slate-500">639.11485...</td>
                            <td class="py-3">€639.11</td>
                            <td class="py-3 text-blue-400 font-bold"
                                >€639.99 (Psychological)</td
                            >
                        </tr>
                    </tbody>
                </table>
            </div>

            <p>
                <strong>The Impact:</strong> For a store with 5,000 items, using "Standard
                Rounding" results in prices like €13.04, €7.18, and €92.41. This hurts
                conversion rates. Our "Smart Rounding" strategy (e.g., ceil to .99)
                helps maintain the psychological appeal of prices.
            </p>

            <h3>2. IEEE 754 & The Floating Point Danger</h3>
            <p>
                JavaScript and PHP handle floating point numbers (doubles) in
                ways that can introduce micro-errors during accumulation.
            </p>

            <div
                class="my-6 not-prose rounded-lg overflow-hidden border border-border-dark shadow-lg"
            >
                <Code
                    code={snippet}
                    lang="js"
                    theme="dracula"
                    style="padding: 1.5rem; overflow-x: auto;"
                />
            </div>

            <p>
                When you process millions of transactions (or convert a large
                database), these micro-errors can compound. Our API uses <strong
                    >arbitrary-precision arithmetic</strong
                > libraries to ensure that the Euro adoption rate is applied with
                legal exactness before any rounding strategy is applied.
            </p>

            <h3>3. Architecture: Why an API?</h3>
            <p>
                We chose to offload the conversion logic to a Cloudflare Workers
                API for three reasons:
            </p>
            <ul>
                <li>
                    <strong>Atomic Batches:</strong> We send products in chunks of
                    50. The API validates the entire chunk. If one calculation fails
                    (e.g., invalid data type), the whole chunk is rejected. This prevents
                    "partial corruption" of your database.
                </li>
                <li>
                    <strong>Immutability:</strong> The conversion rate (1.95583) is
                    hardcoded and protected in the API environment variables. It cannot
                    be altered by a malicious admin or a buggy WP theme.
                </li>
                <li>
                    <strong>Performance:</strong> Offloading the math saves the WP
                    server CPU cycles, allowing it to focus on I/O (updating the database
                    records).
                </li>
            </ul>

            <div
                class="not-prose mt-12 p-8 bg-blue-900/10 border border-blue-500/20 rounded-2xl text-center"
            >
                <h4 class="text-white mb-4">
                    Analyze your store's migration strategy
                </h4>
                <a
                    href="/products/bgn-to-euro-transition"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 rounded-full font-bold hover:bg-blue-500 transition-all"
                >
                    Get the Solution <span class="material-symbols-outlined"
                        >arrow_forward</span
                    >
                </a>
                <p class="mt-4 text-sm text-slate-500">
                    Built by <a href="/" class="text-blue-400 hover:text-white"
                        >Invent2025 Studio</a
                    >
                </p>
            </div>
        </article>
    </main>

    <footer
        slot="footer"
        class="mt-20 border-t border-border-dark pt-8 text-center"
    >
        <p class="text-slate-500 text-xs font-mono">
            © {currentYear} Invent2025 Ltd.
        </p>
    </footer>
</Layout>
